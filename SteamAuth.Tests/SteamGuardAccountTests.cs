using System;
using Microsoft.VisualStudio.TestTools.UnitTesting;

namespace SteamAuth.Tests
{
    [TestClass]
    public class SteamGuardAccountTests
    {
        [TestMethod]
        public void FetchConfirmationInternalTest()
        {
            var response = "<!DOCTYPE html>\r\n<html class=\" responsive touch\" lang=\"en\">\r\n<head>\r\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n\t\t\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1,user-scalable=no\">\r\n\t\t<meta name=\"theme-color\" content=\"#171a21\">\r\n\t\t<title>Steam Community :: Confirmations</title>\r\n\t<link rel=\"shortcut icon\" href=\"/favicon.ico\" type=\"image/x-icon\">\r\n\r\n\t<link href=\"https://steamcommunity-a.akamaihd.net/public/shared/css/motiva_sans.css?v=qIG_iZC1Vj_d\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/shared/css/buttons.css?v=DivqMdJb8hoZ\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/shared/css/shared_global.css?v=HHSzZrXNvURm\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/css/globalv2.css?v=hWbWC6nRzb0K\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/css/skin_1/modalContent.css?v=.TP5s6TzX6LLh\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/css/mobile/styles_mobileconf.css?v=7eOknd5U_Oiy\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/shared/css/motiva_sans.css?v=qIG_iZC1Vj_d\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/css/skin_1/html5.css?v=.MtSlvoLZL0Tb\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/css/skin_1/economy.css?v=BC9LwzSX5z7E\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/css/skin_1/trade.css?v=EGvAxKFGvU8D\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/css/skin_1/profile_tradeoffers.css?v=PZLj_fzQzcKn\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/shared/css/shared_responsive.css?v=Sqh2tLHzRZFc\" rel=\"stylesheet\" type=\"text/css\" >\r\n<link href=\"https://steamcommunity-a.akamaihd.net/public/css/skin_1/header.css?v=nsrVgIBuVLKM\" rel=\"stylesheet\" type=\"text/css\" >\r\n\t\t\t<script>\r\n\t\t\t\t(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\r\n\t\t\t\t\t\t(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\r\n\t\t\t\t\tm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\r\n\t\t\t\t})(window,document,'script','//www.google-analytics.com/analytics.js','ga');\r\n\r\n\t\t\t\tga('create', 'UA-33779068-1', 'auto', {\r\n\t\t\t\t\t'sampleRate': 0.4\t\t\t\t});\r\n\t\t\t\tga('set', 'dimension1', true );\r\n\t\t\t\tga('set', 'dimension2', 'Steam Mobile App' );\r\n\t\t\t\tga('set', 'dimension3', 'mobileconf' );\r\n\t\t\t\tga('set', 'dimension4', \"mobileconf\\/conf\" );\r\n\t\t\t\tga('send', 'pageview');\r\n\r\n\t\t\t</script>\r\n\t\t\t<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/prototype-1.7.js?v=.55t44gwuwgvw\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/scriptaculous/_combined.js?v=9XVsa_Ni33oN&amp;l=english&amp;load=effects,controls,slider,dragdrop\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/global.js?v=BZXok0qpTuhp&amp;l=english\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/jquery-1.11.1.min.js?v=.isFTSRckeNhC\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/shared/javascript/tooltip.js?v=.62cLaJ1QWYOV\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/shared/javascript/shared_global.js?v=R0UmMQGltQpr&amp;l=english\" ></script>\r\n<script type=\"text/javascript\">$J = jQuery.noConflict();\r\nif ( typeof JSON != 'object' || !JSON.stringify || !JSON.parse ) { document.write( \"<scr\" + \"ipt type=\\\"text\\/javascript\\\" src=\\\"https:\\/\\/steamcommunity-a.akamaihd.net\\/public\\/javascript\\/json2.js?v=pmScf4470EZP&amp;l=english\\\" ><\\/script>\\n\" ); };\r\n</script><script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/jquery-ui-1.9.2.min.js?v=.ILEZTVPIP_6a\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/shared/javascript/mobileappapi.js?v=KX5d7WjziQ7F&amp;l=english&amp;mobileClientType=android\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/mobile/mobileconf.js?v=mzd_2xm8sUkb&amp;l=english\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/economy_common.js?v=tsXdRVB0yEaR&amp;l=english\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/economy.js?v=2HnLATIDjHrJ&amp;l=english\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/modalv2.js?v=dfMhuy-Lrpyo&amp;l=english\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/javascript/modalContent.js?v=r2TI9eEWUa2a&amp;l=english\" ></script>\r\n<script type=\"text/javascript\" src=\"https://steamcommunity-a.akamaihd.net/public/shared/javascript/shared_responsive_adapter.js?v=qLEcRmcHn-kc&amp;l=english\" ></script>\r\n<script type=\"text/javascript\">\r\njQuery(document).ready(function($) { $J.data( document, 'x_readytime', new Date().getTime() ); \r\n$('.tooltip').v_tooltip();\r\nwindow.BindStoreTooltip = function( $Selector ) { $Selector.v_tooltip( {'tooltipClass': 'store_tooltip', 'dataName': 'storeTooltip' } ); };\r\nBindStoreTooltip( $('[data-store-tooltip]') ); \r\n});</script>\r\n\t\r\n\t\t\t\t\t\t<meta property=\"og:title\" content=\"Steam Community :: Confirmations\">\r\n\t\t\t\t\t<meta property=\"fb:app_id\" content=\"105386699540688\">\r\n\t\t\t\r\n\t\r\n\t\t\t<link rel=\"image_src\" href=\"https://steamcommunity-a.akamaihd.net/public/shared/images/responsive/share_steam_logo.png\">\r\n\t\t<meta property=\"og:image\" content=\"https://steamcommunity-a.akamaihd.net/public/shared/images/responsive/share_steam_logo.png\">\r\n\t\t\t\t\t<meta property=\"og:image:secure\" content=\"https://steamcommunity-a.akamaihd.net/public/shared/images/responsive/share_steam_logo.png\">\r\n\t\t\t\r\n\t\r\n\t\r\n\t\t\t<script type=\"text/javascript\">\r\n\t\t\t$J(function() {\r\n\t\t\t\t\t\t\t\twindow.location=\"steammobile:\\/\\/settitle?title=Confirmations\";\t\t\t});\r\n\t\t</script>\r\n\t</head>\r\n<body class=\" responsive_page\">\r\n\r\n<div class=\"responsive_page_frame no_header\">\r\n\r\n\t\t\t\r\n\t\t<div class=\"responsive_local_menu_tab\">\r\n\r\n\t\t</div>\r\n\r\n\t\t<div class=\"responsive_page_menu_ctn localmenu\">\r\n\t\t\t<div class=\"responsive_page_menu\"  id=\"responsive_page_local_menu\">\r\n\t\t\t\t<div class=\"localmenu_content\">\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\r\n\r\n\t\t\r\n\t\t<div class=\"responsive_page_content_overlay\">\r\n\r\n\t\t</div>\r\n\r\n\t\t<div class=\"responsive_fixonscroll_ctn nonresponsive_hidden no_menu\">\r\n\t\t</div>\r\n\t\r\n\t<div class=\"responsive_page_content\">\r\n\r\n\t\t<script type=\"text/javascript\">\r\n\tg_sessionID = \"bfb9720a3acaad0aa95f8e10\";\r\n\tg_steamID = \"76561198319214599\";\r\n\r\n\t// We always want to have the timezone cookie set for PHP to use\r\n\tsetTimezoneCookies();\r\n\r\n\t$J( function() {\r\n\r\n\t\tInitMiniprofileHovers();\r\n\t\tInitEmoticonHovers();\r\n\t\twindow.BindCommunityTooltip = function( $Selector ) { $Selector.v_tooltip( {'tooltipClass': 'community_tooltip', 'dataName': 'communityTooltip' } ); };\r\n\t\tBindCommunityTooltip( $J('[data-community-tooltip]') );\r\n\r\n\t\t\t\tApplyAdultContentPreferences();\r\n\t});\r\n\r\n\t$J( function() { InitEconomyHovers( \"https:\\/\\/steamcommunity-a.akamaihd.net\\/public\\/css\\/skin_1\\/economy.css?v=BC9LwzSX5z7E\", \"https:\\/\\/steamcommunity-a.akamaihd.net\\/public\\/javascript\\/economy_common.js?v=tsXdRVB0yEaR&l=english\", \"https:\\/\\/steamcommunity-a.akamaihd.net\\/public\\/javascript\\/economy.js?v=2HnLATIDjHrJ&l=english\" );});</script>\r\n\r\n\t\t<div class=\"responsive_page_template_content\">\r\n\r\n\t\t\t\t<div id=\"mobileconf_list\">\r\n\t\t<div class=\"mobileconf_list_entry\" id=\"conf4531061614\" data-confid=\"4531061614\" data-key=\"14740019096288254715\" data-type=\"2\" data-creator=\"3052917248\" data-cancel=\"Cancel\" data-accept=\"Send Offer\" >\r\n\t<div class=\"mobileconf_list_entry_content\">\r\n\t\t<div class=\"mobileconf_list_entry_icon\">\r\n\t\t\t<div class=\"playerAvatar online\"><img src=\"https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/1b/1b798cbffdaf04785cff7d17063498fe24678039.jpg\" srcset=\"https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/1b/1b798cbffdaf04785cff7d17063498fe24678039.jpg 1x, https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/1b/1b798cbffdaf04785cff7d17063498fe24678039_medium.jpg 2x\"></div>\t\t</div>\t\t\t\t<div class=\"mobileconf_list_entry_description\">\r\n\t\t\t<div>Trade <span style=\"color: #D2D2D2\">Effigy Block of Frost</span>, ... to Nowayim[Crazy]</div>\r\n\t\t\t<div>You will receive nothing</div>\r\n\t\t\t<div>Just now</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class=\"mobileconf_list_entry_sep\"></div>\r\n</div>\r\n\t</div>\r\n\t<div id=\"mobileconf_done\" class=\"mobileconf_done mobileconf_header\" style=\"display: none\">\r\n\t\t<div>All done</div>\r\n\t\t<div>You're all done, there's nothing left to confirm.</div>\r\n\t</div>\r\n\r\n<div id=\"mobileconf_details\" style=\"display: none\">\r\n</div>\r\n\r\n<div id=\"mobileconf_buttons\" style=\"display: none\">\r\n\t<div>\r\n\t<div class=\"mobileconf_button mobileconf_button_cancel\">\r\n\t</div><div class=\"mobileconf_button mobileconf_button_accept\">\r\n\t</div>\r\n\t</div>\r\n</div>\r\n\r\n<div id=\"mobileconf_throbber\" style=\"display: none\">\r\n\t<div style=\"text-align:center; margin: auto;\">\r\n\t\t<img src=\"https://steamcommunity-a.akamaihd.net/public/images/login/throbber.gif\" alt=\"Loading\">\r\n\t</div>\r\n</div>\r\n\r\n\t\t</div>\t<!-- responsive_page_legacy_content -->\r\n\r\n\t\t\t<div id=\"footer_spacer\"></div>\r\n\t<div id=\"footer_responsive_optin_spacer\"></div>\r\n\t<div id=\"footer\">\r\n\t\t<div class=\"footer_content\">\r\n\t\t\t<span id=\"footerLogo\"><img src=\"https://steamcommunity-a.akamaihd.net/public/images/skin_1/footerLogo_valve.png?v=1\" width=\"96\" height=\"26\" border=\"0\" alt=\"Valve Logo\" /></span>\r\n\t\t\t<span id=\"footerText\">\r\n\t\t\t\t&copy; Valve Corporation. All rights reserved. All trademarks are property of their respective owners in the US and other countries.<br/>Some geospatial data on this website is provided by <a href=\"https://steamcommunity.com/linkfilter/?url=http://www.geonames.org\" target=\"_blank\" rel=\"noreferrer\">geonames.org</a>.\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t\t<span class=\"valve_links\">\r\n\t\t\t\t\t\t<a href=\"http://store.steampowered.com/privacy_agreement/\" target=\"_blank\">Privacy Policy</a>\r\n\t\t\t\t\t\t&nbsp; | &nbsp;<a href=\"http://www.valvesoftware.com/legal.htm\" target=\"_blank\">Legal</a>\r\n\t\t\t\t\t\t&nbsp;| &nbsp;<a href=\"http://store.steampowered.com/subscriber_agreement/\" target=\"_blank\">Steam Subscriber Agreement</a>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t</div>\r\n\t\t\t\t\t<div class=\"responsive_optin_link\">\r\n\t\t\t\t<div class=\"btn_medium btnv6_grey_black\" onclick=\"Responsive_RequestMobileView()\">\r\n\t\t\t\t\t<span>View mobile website</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t</div>\r\n\t\r\n\t</div>\t<!-- responsive_page_content -->\r\n\r\n</div>\t<!-- responsive_page_frame -->\r\n</body>\r\n</html>";
            var steamGuardAccount = new SteamGuardAccount();
            var confirmations = steamGuardAccount.FetchConfirmationInternal(response);
            Assert.AreEqual(1, confirmations.Length);
            Assert.AreEqual(Confirmation.ConfirmationType.Trade, confirmations[0].ConfType);
            Assert.IsTrue(confirmations[0].Description.Contains("Nowayim[Crazy]"));
            Assert.AreEqual("4531061614", confirmations[0].ID);
            Assert.AreEqual("14740019096288254715", confirmations[0].Key);
        }
    }
}
